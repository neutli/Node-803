# ノードエディタアプリケーション - 機能リスト

## 📋 目次
- [実装済み機能](#実装済み機能)
- [今後の追加予定](#今後の追加予定)
- [長期的なビジョン](#長期的なビジョン)

---

## ✅ 実装済み機能

### 🎨 コアノードシステム

#### ノード基盤クラス
- **Node**: すべてのノードの基底クラス
- **NodeSocket**: 入力/出力ソケット管理
  - 対応データ型: Float, Vector, Color, Integer
  - デフォルト値設定
  - 接続状態管理
- **NodeConnection**: ノード間の接続管理
  - データフロー処理
  - 自動値伝播

#### グラフィカルUI
- **NodeGraphicsItem**: ノードのビジュアル表現
  - ドラッグ&ドロップで移動
  - 選択時のハイライト（オレンジ枠）
  - リアルタイムプレビュー（150x150px）
  - インラインパラメータウィジェット
- **NodeGraphicsSocket**: ソケットのビジュアル表現
  - 型別の色分け：
    - Float: グレー
    - Vector: ブルー
    - Color: イエロー
    - Integer: グリーン
- **ConnectionGraphicsItem**: 接続線の描画
  - ベジェ曲線による滑らかな線
  - ドラッグ&ドロップで接続作成

### 🖼️ ノードエディタウィンドウ

#### キャンバス機能
- グリッド背景（20pxグリッド、100px太線）
- ダークテーマ（背景: #282828）
- **ズーム**: マウスホイール（0.1x～3.0x、カーソル位置中心）
- **パン**: 
  - スペースキー + 左ドラッグ
  - 中ボタンドラッグ

#### コンテキストメニュー
右クリックでノード追加：
- Add Noise Texture
- Add Mapping
- Add Output
- Add Texture Coordinate
- Add River
- Add Invert

### 🎛️ UI/UXコンポーネント

#### SliderSpinBox（カスタムウィジェット）
- スライダーと数値入力の組み合わせ
- Blender風の入力体験
- 広範囲の数値入力対応（スピンボックス側）
- 直感的な範囲調整（スライダー側）

#### 分割ビューレイアウト
- QSplitterによる2分割表示
- 左: ノードエディタ（70%）
- 右: 画像結果（30%）
- サイズ調整可能な境界線

#### リアルタイムプレビュー
- 自動更新機能（チェックボックスでON/OFF）
- 300msのデバウンス処理
- デフォルトは無効（手動"Run"が必要）

### 🎭 実装済みノード

#### 1. Noise Texture Node
**パラメータ**:
- Scale: 0.1 - 100.0（ノイズのスケール）
- Detail: 0 - 16（オクターブ数）
- Roughness: 0.0 - 1.0（減衰率）
- Distortion: 0.0 - 10.0（歪み）
- Lacunarity: 1.0 - 4.0（周波数の倍率）
- Offset: 0.0 - 5.0（Ridged Multifractal用）

**ノイズタイプ**:
- Perlin（デフォルト）
- Simplex（より滑らか）
- Ridged Multifractal（尾根状）
- White（ランダム）
- Gabor（ガボールノイズ）

**ソケット**:
- 入力: Vector（座標）
- 出力: Fac（ノイズ値）, Color（グレースケール）

**UI**:
- ノイズタイプ選択ボタン
- 各パラメータにSliderSpinBox
- リアルタイムプレビュー

#### 2. River Texture Node
自然な川テクスチャ生成ノード

**アルゴリズム**:
- ノイズベースの不規則な水源形状
- Ridge Noiseによる川の流れパターン
- 指数関数的な距離減衰
- マルチオクターブノイズで詳細追加

**パラメータ**:
- Scale: 0.1 - 100.0（全体スケール）
- Flow: 0.0 - 10.0（流れの強度）
- Grid Size: 1.0 - 20.0（水源グリッド密度）
- Threshold Min: 0.0 - 1.0（川の最小閾値）
- Threshold Max: 0.0 - 1.0（川の最大閾値）
- Seed: 0.0 - 100.0（バリエーション生成用）

**ソケット**:
- 入力: Vector（座標）、各パラメータ
- 出力: Fac（川マスク値）

#### 3. Invert Node
カラー反転ノード

**パラメータ**:
- Fac: 0.0 - 1.0（反転強度）

**ソケット**:
- 入力: Color, Fac
- 出力: Color（反転結果）

**用途**:
- 白い湖を黒く反転
- ネガポジ反転エフェクト

#### 4. Mapping Node
ベクトル変換ノード（Blender互換）

**パラメータ**:
- Location: X, Y, Z（移動）
- Rotation: X, Y, Z（回転、ラジアン）
- Scale: X, Y, Z（スケール）

**ソケット**:
- 入力: Vector, Location, Rotation, Scale
- 出力: Vector（変換後）

**機能**:
- アフィン変換による座標操作
- テクスチャのマッピング調整

#### 5. Texture Coordinate Node
テクスチャ座標生成ノード

**パラメータ**:
- Width: 1 - 10000（画像幅）
- Height: 1 - 10000（画像高）

**ソケット**:
- 入力: Width, Height
- 出力: UV（正規化座標）

**機能**:
- ピクセル座標を0.0-1.0範囲に正規化
- テクスチャ生成の起点

#### 6. Output Node
最終出力ノード

**ソケット**:
- 入力: Surface（Color）

**機能**:
- ノードグラフの終端
- 画像生成の最終出力先

### 🛠️ メインウィンドウ機能

#### ツールバー
- **Run**: ノードグラフを評価して画像生成
- **Export**: 生成画像を保存（PNG/JPG/BMP）
- **Auto Update**: 自動プレビュー更新のON/OFF

#### 画像結果タブ
- 解像度設定（Width/Height: 1-4096px）
- デフォルト: 512x512
- 生成画像の表示
- スクロール可能

#### 画像生成エンジン
- **座標ベース評価**: ピクセルごとにノードグラフを評価
- **並列処理対応**: QtConcurrentでマルチスレッド処理
- **リアルタイム更新**: パラメータ変更時の自動再計算

### 🎨 ノイズアルゴリズム

#### Perlin Noise
- 2D/3D対応
- グラデーションベクトル補間
- オクターブノイズ対応

#### Simplex Noise
- Perlinより計算効率が高い
- より自然な見た目

#### Ridged Multifractal
- `1.0 - abs(noise)` による尾根パターン
- 山脈や川の生成に適している

#### White Noise
- 完全ランダム
- グレインエフェクト

#### Gabor Noise
- 周波数制御可能
- テクスチャ合成に適している

---

## 🚀 今後の追加予定

### 🎯 Phase 1: 基本機能の拡張（優先度: 高）

#### 関数ノード群
River内部アルゴリズムのモジュール化

1. **Ridge Noise Node**
   - Multi-octave ridge noise生成
   - Scale, Detail, Roughnessパラメータ
   - Ridge特有の鋭い稜線

2. **Distance Field Node**
   - 中心からの距離計算
   - 2D/3D対応
   - 放射グラデーション生成

3. **Math Nodes**（複数の演算ノード）
   - **Add**: A + B
   - **Subtract**: A - B
   - **Multiply**: A × B
   - **Divide**: A ÷ B
   - **Power**: A ^ B
   - **Min**: min(A, B)
   - **Max**: max(A, B)
   - **Abs**: |A|
   - **Exp**: e ^ A
   - **Smoothstep**: 滑らか補間
   - **Clamp**: 値の範囲制限

4. **Map Range Node**
   - 値の範囲を再マッピング
   - From Min/Max → To Min/Max
   - Blender互換

### 🎨 Phase 2: テクスチャノードの追加（優先度: 中）

1. **Voronoi Texture Node**
   - F1, F2, Distance, Cells, Edge出力
   - 岩や細胞パターン生成

2. **Gradient Texture Node**
   - Linear, Quadratic, Radial, Spherical
   - 基本的なグラデーション

3. **Wave Texture Node**
   - Sine/Saw波パターン
   - 木目や波紋効果

4. **Musgrave Texture Node**
   - フラクタルノイズバリエーション
   - Multifractal, Ridged, Hybrid, fBm, Hetero

5. **Checker Texture Node**
   - チェッカーボードパターン
   - スケール調整可能

### 🌈 Phase 3: カラーノード（優先度: 中）

1. **Color Ramp Node**
   - グラデーションマッピング
   - カスタムカラーストップ
   - 補間モード（Linear, Ease, Constant）

2. **Mix RGB Node**
   - ブレンドモード:
     - Mix, Add, Multiply, Screen
     - Overlay, Subtract, Divide
     - Difference, Darken, Lighten
   - Facパラメータでブレンド強度

3. **RGB Curves Node**
   - トーンカーブ調整
   - R, G, B個別制御

4. **Hue Saturation Value Node**
   - 色相、彩度、明度調整
   - HSVカラー空間操作

5. **Bright/Contrast Node**
   - 明るさとコントラスト調整

### 🔄 Phase 4: コンバータノード（優先度: 低）

1. **ColorRamp Node** → 既に Phase 3 に含まれる
2. **Separate RGB/XYZ Node**
   - ベクトル/カラーを成分分解
3. **Combine RGB/XYZ Node**
   - 成分から合成
4. **Math Node** → 既に Phase 1 に含まれる

### 📊 Phase 5: UI/UX改善（優先度: 中）

1. **ノード検索機能**
   - タブキーでノード追加ダイアログ
   - インクリメンタル検索
   - カテゴリフィルター

2. **ノードグループ化**
   - 複数ノードを1つにまとめる
   - カスタムノード作成
   - 再利用可能

3. **ミニマップ**
   - キャンバス全体の俯瞰表示
   - 大規模グラフのナビゲーション

4. **ノードプレビューモード**
   - 個別ノードの出力をフルサイズ表示
   - デバッグ用

5. **パラメータアニメーション**
   - キーフレーム設定
   - タイムライン
   - アニメーション動画出力

### 💾 Phase 6: プロジェクト管理（優先度: 高）

1. **ファイル保存/読込**
   - ノードグラフの保存（JSON/XML形式）
   - プロジェクトファイル管理
   - 最近使用したファイル

2. **テンプレート機能**
   - よく使うノードセットアップを保存
   - プリセットライブラリ

3. **バッチ処理**
   - 複数の設定で一括生成
   - シーケンス画像出力

### 🎬 Phase 7: レンダリング機能（優先度: 中）

1. **高解像度レンダリング**
   - タイル分割レンダリング
   - プログレスバー表示
   - キャンセル機能

2. **EXRフォーマット対応**
   - 32bit浮動小数点画像
   - HDRテクスチャ生成

3. **アニメーション出力**
   - 時間軸の追加
   - MP4/GIF出力

### 🔌 Phase 8: 拡張性（優先度: 低）

1. **プラグインシステム**
   - カスタムノードの動的ロード
   - Pythonスクリプト対応

2. **外部テクスチャ読み込み**
   - 画像ファイルをノードとして使用
   - Image Textureノード

3. **OpenGL/Vulkanプレビュー**
   - GPUアクセラレーション
   - リアルタイム高速プレビュー

---

## 🌟 長期的なビジョン

### 完全なBlenderジオメトリノード互換
- すべての標準ノードを実装
- Blenderプロジェクトファイルのインポート

### 3Dテクスチャ対応
- ボリュームノイズ
- 3Dプレビュー

### マテリアルシステム
- PBRマテリアル設定
- Metallic, Roughness, Normal maps
- リアルタイムレンダリングプレビュー

### AIノード
- Stable Diffusion統合
- スタイル転送
- ノイズ除去

### クラウド連携
- プロジェクトの共有
- コミュニティライブラリ
- オンラインレンダリング

---

## 📈 開発ロードマップ

### 短期（1-2ヶ月）
- [ ] Phase 1: 関数ノード実装
- [ ] Phase 6: ファイル保存/読込

### 中期（3-6ヶ月）
- [ ] Phase 2: テクスチャノード追加
- [ ] Phase 3: カラーノード実装
- [ ] Phase 5: UI/UX改善

### 長期（6ヶ月以降）
- [ ] Phase 7: レンダリング機能
- [ ] Phase 8: 拡張性
- [ ] 3D機能
- [ ] AI統合

---

**最終更新**: 2025年11月22日
